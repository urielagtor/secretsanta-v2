<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intercambio NavideÃ±o MÃ¡gico ğŸ„</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <script src="vendors/Lodash-3.10.1.js"></script>
    <script src="vendors/Cryptojs.aes-3.1.2.js"></script>
    <script src="./SecretSanta.js"></script>
</head>
<body>
    <header class="main-header">
        <h1>Generador de Amigo Secreto ğŸ…</h1>
        <p>Â¡La herramienta oficial del Polo Norte para organizar tu intercambio!</p>
    </header>

    <main class="container">
        <section class="card instructions">
            <h2>Â¡La MisiÃ³n NavideÃ±a Comienza! âœ¨</h2>
            <p>Â¡Hola, Ayudante de Santa! Organizar el intercambio es mÃ¡s fÃ¡cil que decorar un Ã¡rbol. Sigue estos pasos:</p>
            <ol>
                <li><strong>Prepara la Lista de Santa:</strong> En el "Centro de Control", escribe el nombre de cada participante, Â¡uno por cada renglÃ³n mÃ¡gico!</li>
                <li><strong>Agrega Reglas Especiales (Opcional):</strong>
                    <ul>
                        <li>Para <strong>evitar</strong> que dos personas se regalen, usa `!` (Ej: `Juan !Maria`).</li>
                        <li>Para <strong>forzar</strong> que alguien le regale a otra persona, usa `=` (Ej: `Ana = Pedro`).</li>
                    </ul>
                </li>
                <li><strong>Â¡Lanza la Magia!:</strong> Cuando la lista estÃ© completa, presiona el gran botÃ³n rojo "Â¡Hacer la Magia!".</li>
                <li><strong>Reparte los Secretos:</strong> Se generarÃ¡ un enlace Ãºnico para cada persona. CÃ³pialo y envÃ­alo. Â¡Shhh! ğŸ¤« Â¡Que nadie vea el de otro!</li>
            </ol>
        </section>

        <section class="card generator">
            <h2>Polo Norte Control Center</h2>
            <form id="form">
                <label for="input">Escribe aquÃ­ los nombres de los valientes participantes:</label>
                <textarea id="input" class="input-area" autofocus></textarea>
                <button type="submit" class="generate-button">Â¡Hacer la Magia! ğŸ</button>
                <div id="result" class="result-box none"></div>
            </form>
        </section>
    </main>
    
    <footer class="main-footer">
        <p>Hecho con amor y galletas de jengibre ğŸª</p>
    </footer>

    <script id="input-placeholder" type="text/placeholder">
# Â¡AquÃ­ va tu lista de elfos y renos!
# Por ejemplo:
Rodolfo
Cometa
Cupido

# Evita que MamÃ¡ Noel le regale a Santa
MamÃ¡ Noel !Santa Claus

# AsegÃºrate de que el Grinch le regale a Max
El Grinch = Max
    </script>
    <script>
        // TODO: Pega aquÃ­ todo el JavaScript original, desde la funciÃ³n isAmazonEnabled() hasta restore();
        // El JavaScript original que controla la lÃ³gica no necesita cambios.
        function isAmazonEnabled(){const checkBox=document.getElementById('amazon');return checkBox?checkBox.checked:false}function persist(){if(!window.localStorage)return;var amazon=isAmazonEnabled();var content=document.getElementById('input').value;window.localStorage.setItem('amazon',amazon);window.localStorage.setItem('input',content)}function restore(){if(!window.localStorage)return;var amazon=window.localStorage.getItem('amazon');var content=window.localStorage.getItem('input');if(typeof amazon==='undefined')amazon=true;if(typeof content==='undefined')content='';if(document.getElementById('amazon'))
        document.getElementById('amazon').checked=amazon;document.getElementById('input').value=content}function reset(){var result=document.getElementById('result');result.classList.add('none');result.classList.remove('error')}function error(text){var result=document.getElementById('result');result.classList.remove('none');result.classList.add('error');result.innerText=text}function success(pairings){var result=document.getElementById('result');result.classList.remove('none');result.classList.remove('error');result.innerHTML='';var table=document.createElement('table');table.className='result-table';
        result.appendChild(table);var names=Object.keys(pairings).sort();for(var t=0,T=names.length;t<T;++t){var name=names[t];var prettyName=names[t].replace(/\([^)]+\)/g,' ').replace(/ +/g,' ').trim();var tr=document.createElement('tr');tr.className='result-row';table.appendChild(tr);var tdName=document.createElement('td');tdName.className='result-name';tr.appendChild(tdName);var tdLink=document.createElement('td');tdLink.className='result-link';tr.appendChild(tdLink);var link=document.createElement('a');tdLink.appendChild(link);
        var key=String(_.random(0x0000,0xFFFF));var encryptedPairing=CryptoJS.AES.encrypt(pairings[name],key);var pairingPath=window.location.pathname.replace(/[^/]+$/,'')+'pairing.html';var pairingQueryString='?name='+encodeURIComponent(prettyName)+'&key='+encodeURIComponent(key)+'&pairing='+encodeURIComponent(encryptedPairing);if(isAmazonEnabled())
        pairingQueryString+='&extra=1';tdName.innerText=name;link.addEventListener('click',protect);link.setAttribute('data-name',name);link.href=window.location.protocol+'//'+window.location.host+pairingPath+pairingQueryString;link.target='_blank';link.innerText=link.href}}
        function updateAmazon(){var result=document.getElementById('result');var links=result.getElementsByTagName('a');for(var t=0;t<links.length;++t){var link=links[t];if(isAmazonEnabled())
        link.href+='&extra=1';else
        link.href=link.href.replace(/&extra=[01]/,'');link.innerText=link.href}}
        function generate(e){e.preventDefault();var content=document.getElementById('input').value;content=content.replace(/(\r\n|\r)/g,'\n');content=content.replace(/[ \t]+/g,' ');content=content.replace(/^ | $/gm,'');content=content.replace(/^#.*$/gm,'');content=content.replace(/\n+/g,'\n');content=content.replace(/^\n|\n$/g,'');var lines=content.split(/\n/g);if(lines.length===0||lines.length===1&&lines[0].length===0)
        return reset();var santa=new SecretSanta();for(var t=0,T=lines.length;t<T;++t){var match=lines[t].match(/^((?:(?![!=]).)+)((?: [!=](?:(?! [!=]).)+)*)$/);if(!match)
        return error('Syntax error: "'+lines[t]+'" isn\'t valid');var name=match[1];var rules=match[2]?match[2].match(/[!=][^!=]+/g):null;var person=santa.add(name);if(rules){for(var u=0,U=rules.length;u<U;++u){var fnName={'=':'enforce','!':'blacklist'}[rules[u].charAt(0)];person[fnName](rules[u].slice(1).trim())}}}
        try{return success(santa.generate())}catch(err){console.error(err.stack)
        return error(err.message)}}
        function protect(e){var name=e.currentTarget.getAttribute('data-name');if(!confirm('Â¡Cuidado! Si haces clic, se revelarÃ¡ el amigo secreto de '+name+'. Â¿EstÃ¡s seguro de que eres '+name+'?\n\nMejor haz clic derecho y "Copiar direcciÃ³n del enlace" para compartirlo.'))
        {e.preventDefault()}}
        document.getElementById('input').placeholder=document.getElementById('input-placeholder').innerHTML.trim().replace(/^[ \t]+/gm,'');document.getElementById('input').addEventListener('change',persist);if(document.getElementById('amazon')){document.getElementById('amazon').addEventListener('change',updateAmazon);document.getElementById('amazon').addEventListener('change',persist)}
        document.getElementById('form').addEventListener('submit',generate);restore();
    </script>
</body>
</html>
